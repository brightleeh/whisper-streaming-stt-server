server:
  port: 50051 # gRPC listen port
  http_host: "127.0.0.1" # HTTP metrics/health bind host
  max_sessions: 4 # Concurrent gRPC sessions
  metrics_port: 8000 # HTTP metrics/health port
  grpc_worker_threads: 0 # gRPC thread pool size (0 = auto; keep >max_sessions to avoid starving short RPCs)
  decode_timeout_sec: 30 # Seconds to wait for decode tasks when draining
  log_metrics: false # Emit decode metrics logs
  session_timeout_sec: 60 # Seconds of inactivity before aborting a session
  max_buffer_sec: 20 # Max buffered audio seconds before partial decode/trim (null disables)
  max_buffer_bytes: null # Max buffered audio bytes before partial decode/trim (null disables)
  max_chunk_ms: 2000 # Max single chunk duration in milliseconds (null disables)
  partial_decode_interval_sec: 1.5 # Partial decode interval during speech (null disables)
  partial_decode_window_sec: 10.0 # Window size for partial decode audio (seconds)
  max_pending_decodes_per_stream: 8 # Max queued decodes per stream before dropping partials
  max_pending_decodes_global: 64 # Global max queued decodes before backpressure/drop
  max_total_buffer_bytes: 67108864 # Global buffered audio cap (bytes)
  decode_queue_timeout_sec: 1.0 # Seconds to wait for a global decode slot (final only)
  buffer_overlap_sec: 0.5 # Overlap window retained after partial decode (seconds)
  grpc_max_receive_message_bytes: 8388608 # Max gRPC inbound message size
  grpc_max_send_message_bytes: 4194304 # Max gRPC outbound message size
  sample_rate: 16000 # Fallback sample rate when chunks omit it

vad:
  silence: 0.5 # Seconds of trailing silence to trigger decode
  threshold: 0.5 # Silero VAD speech probability threshold (0-1)
  model_pool_size: 4 # VAD model pool size (0 uses max_sessions)
  model_prewarm: 1 # Prewarm VAD models on startup
  model_pool_growth_factor: 1.5 # VAD pool growth factor on demand

safety:
  speech_rms_threshold: 0.00 # Minimum RMS required before decoding buffered audio

logging:
  level: "INFO" # TRACE/DEBUG/INFO/WARN/ERROR
  file: null # Optional log file path
  faster_whisper_level: null # Optional: override faster_whisper logger level
  log_transcripts: false # Log transcript text in decode logs (PII risk)

tls:
  cert_file: null # Path to TLS cert chain (enables gRPC TLS)
  key_file: null # Path to TLS private key (enables gRPC TLS)

metrics:
  expose_api_key_sessions: false # Include active_sessions_by_api in /metrics payload

storage:
  persist_audio: false # Enable server-side audio capture
  directory: "data/audio" # Directory to store captured audio
  queue_max_chunks: 256 # Max queued PCM chunks before dropping oldest
  max_bytes: null # Optional cap on total bytes in directory
  max_files: null # Optional maximum number of stored files
  max_age_days: null # Optional retention window in days

health:
  window_sec: 60 # Rolling window for decode health aggregation
  min_events: 5 # Minimum events before evaluating health ratios
  max_timeout_ratio: 0.5 # Degraded when decode timeouts exceed this ratio
  min_success_ratio: 0.5 # Degraded when successful decodes fall below this ratio
